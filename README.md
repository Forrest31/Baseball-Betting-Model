# Baseball-Betting-Model
Predictive machine learning logistic regression model for MLB games 
This repository contains two R markdown files, the first trains and validates a machine learning model which generates a probability of the home team winning. The second file deploys the model against the day’s games and calculates the “edge” of each pick as defined by the implied probability of the given odds to win minus the probability of winning provided by the model.  

The XGBoost model is trained on MLB games between 2000-2020 using data provided by Retrosheet and Baseball Reference. The model was validated on games played in 2021 and 2022. After ingestion, the data required cleaning to create consistent team names and results as well as remove NA values. The next step was feature engineering to ultimately produce season-to-date and recent Pythagorean records for both home and away teams as well as the season-to-date and recent Log 5 for the home team.  In summing runs for and against for the home and away teams, I subtracted the runs scored and allowed for that day’s game to avoid data leakage. This feature is important when choosing the number of games to include in recent performance. Because the roll away function will sum that day’s games, the value of k should be one higher than the number of games you want to evaluate (e.g. if you want to look at the last 7 games, the value of k should be 8).

The tooling used to collect the data returns game results for each team, resulting in two observations for each game; one from the perspective of the home team and the same data from that of the away team. The data needed to be transformed to combine the statistics from the home and away team into a single observation representing a single game. To do this, we create a unique ID for each game assigned to each team playing in the game, and split the data into home and away, and perform a left join on the game ID present in both data sets. 

After cleaning and feature engineering, I perform cross validation to determine the optimal number of trees to train. After fitting the model, it is validated on 2021-22 games. The overall accuracy is 59%. The accuracy steadily increases as the threshold for predicting a home team win increases.  For example, if a 66% probability is present for either team, accuracy increases by 13 percent.  However, this level of confidence only appears in 17 percent of predictions. I’ve also included a SHAP analysis to show which inputs play the biggest role in the prediction. 

The deployment file first ingests the most recent data and cleans it followed by performing the necessary feature engineering to ensure the data’s format exactly matches what the model was trained on.  To identify where any potential value lies, the user will need to manually input the home and away teams as well as the odds for each team to win. The output will be a table with each game and, the model’s probability of each team winning, the implied probability from the odds, as well as the expected value of each pick. 


